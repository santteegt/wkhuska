wkhomeControllers.controller("map",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData",function(e,a,o,n,t,c){if(a.ifClick=function(a){c.genericData=a,o.location.hash="/"+e.lang+"/w/cloud?datacloud"},a.themes=[],c.allkeywords)a.relatedtags=c.allkeywords,a.selectedTagItem="Semantic Web";else{waitingDialog.show("Loading Research Areas");var i=n.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key }  WHERE {      SELECT  (count(?pubs) as ?total)      WHERE {          graph <"+n.centralGraph+'> {             ?subject foaf:publications ?pubs.              ?pubs bibo:Quote ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }     }      GROUP BY ?keyword  ?key      HAVING(?total > 4) }';t.querySrv({query:i},function(e){jsonld.compact(e,n.CONTEXT,function(e,o){_.map(o["@graph"],function(e){var o={};o.id=e["@id"],o.tag=e["rdfs:label"],a.themes.push({tag:o.tag})}),a.$apply(function(){a.relatedtags=a.themes,a.selectedTagItem="Semantic Web",c.allkeywords=a.themes}),waitingDialog.hide()})})}a.$watch("selectedTagItem",function(){a.selectedTagItem=a.selectedTagItem?a.selectedTagItem:"Semantic Web",waitingDialog.show('Consultando Ubicacion de Autores Relacionados con:  "'+a.selectedTagItem+'"');var e=n.PREFIX+' CONSTRUCT {          ?urikeyword bibo:Quote "'+a.selectedTagItem+'".          ?urikeyword uc:totalpublications ?cont.          ?urikeyword uc:name ?sourcename.           ?urikeyword uc:lat ?lat.          ?urikeyword uc:long ?long.          ?urikeyword uc:province ?province.          ?urikeyword uc:city ?city.          ?urikeyword uc:fullname ?fullname.  } WHERE {     SELECT (COUNT( DISTINCT ?object) as ?cont) ?provenance  ?urikeyword ?provenance ?sourcename ?lat ?long ?province ?city ?fullname      WHERE {         GRAPH <'+n.centralGraph+'>  {             ?subject foaf:publications ?object.             ?object bibo:Quote ?key.             FILTER (mm:fulltext-search(?key, "'+a.selectedTagItem+'")) .             ?subject dct:provenance ?provenance.             {                  SELECT DISTINCT ?sourcename ?lat ?long ?province ?city (STR(?name) as ?fullname)                  WHERE {                      GRAPH <'+n.endpointsGraph+'>  {                          ?provenance uc:name ?sourcename.                          ?provenance  uc:latitude ?lat.                          ?provenance uc:longitude ?long.                          ?provenance uc:province ?province.                          ?provenance uc:city ?city.                          ?provenance uc:fullName ?name.                         FILTER (lang(?name) = "es").                     }                  }              }              BIND(REPLACE("'+a.selectedTagItem+'"," ","_","i") + "_" + ?sourcename  as ?iduri).              BIND(IRI(?iduri) as ?urikeyword)          }      }      GROUP BY ?sourcename ?provenance ?lat ?long ?province ?city ?fullname  ?urikeyword  } ';a.publicationsBySource=[],t.querySrv({query:e},function(e){jsonld.compact(e,n.CONTEXT,function(e,o){if(o["@graph"]){waitingDialog.hide();_.map(o["@graph"],function(e){var o={};o.id=e["@id"],o.name=e["uc:name"],o.fullname=e["uc:fullname"],o.total=e["uc:totalpublications"]["@value"],o.lat=e["uc:lat"],o["long"]=e["uc:long"],o.keyword=e["bibo:Quote"],o.city=e["uc:city"],o.province=e["uc:province"],o.id&&a.publicationsBySource.push({id:o.id,name:o.name,fullname:o.fullname,total:o.total,latitude:o.lat,longitude:o["long"],city:o.city,province:o.province,keyword:o.keyword})}),a.$apply(function(){a.data=a.publicationsBySource})}else alert("Informacion no encontrada"),waitingDialog.hide()})})})}]);